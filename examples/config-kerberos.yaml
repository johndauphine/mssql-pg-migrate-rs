# SQL Server to PostgreSQL migration with Kerberos authentication
#
# ============================================================================
# IMPORTANT: PLATFORM LIMITATIONS (Rust Implementation)
# ============================================================================
#
# MSSQL Kerberos Authentication:
#   - WINDOWS ONLY: The tiberius driver only supports Kerberos via Windows SSPI
#     (Security Support Provider Interface). This means:
#     * Windows client → Windows SQL Server: WORKS (via SSPI)
#     * Linux/macOS client → Windows SQL Server: NOT SUPPORTED
#   - On non-Windows platforms, the tool will log a warning and fall back to
#     password authentication. You must provide user/password in the config.
#   - NOTE: The Go implementation (mssql-pg-migrate) has full cross-platform
#     Kerberos support via the go-mssqldb krb5 authenticator.
#
# PostgreSQL GSSAPI Authentication:
#   - LIMITED: tokio-postgres does not have native GSSAPI support
#   - Workaround: Use a connection proxy like pgbouncer with GSSAPI, or
#     use libpq-based tools for the PostgreSQL connection
#   - The gssencmode config option is accepted but may require external setup
#
# If you need cross-platform Kerberos support, consider using the Go version
# of this tool instead.
#
# ============================================================================
#
# Prerequisites (Windows only for MSSQL):
#   1. Ensure the Windows client is domain-joined or has Kerberos configured
#   2. Run as a user with a valid Kerberos ticket, or use runas /netonly
#   3. For PostgreSQL GSSAPI: configure external proxy or use password auth
#
# Usage:
#   ./mssql-pg-migrate -c examples/config-kerberos.yaml run

source:
  type: mssql
  host: sqlserver.corp.example.com
  port: 1433
  database: SourceDatabase
  schema: dbo
  auth: kerberos
  user: svc_migrate@CORP.EXAMPLE.COM
  # Optional: specify keytab file instead of using credential cache
  # keytab: /etc/mssql-migrate.keytab
  realm: CORP.EXAMPLE.COM
  encrypt: true
  trust_server_cert: false

target:
  type: postgres
  host: postgres.corp.example.com
  port: 5432
  database: target_db
  schema: public
  auth: kerberos
  user: svc_migrate@CORP.EXAMPLE.COM
  gssencmode: require
  ssl_mode: disable  # SSL disabled when using GSSAPI encryption

migration:
  workers: 8
  chunk_size: 200000
  create_indexes: true
  create_foreign_keys: true
  create_check_constraints: true
  target_mode: drop_recreate
